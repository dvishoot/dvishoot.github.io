{{ partial "fonts.html" . }}
{{/* Apply palette preference ASAP to avoid noticeable flash. */}}
<script>
(() => {
  const palettes = ["palette-burgundy", "palette-teal", "palette-amber"];
  const html = document.documentElement;
  const configFallback = {{ site.Params.bodyClass | default "palette-teal" | jsonify }};
  const sanitize = (value) => (value || "").replace(/^['"]+|['"]+$/g, "");
  const normalizeClassName = () => {
    const tokens = html.className.split(/\s+/).map((token) => sanitize(token)).filter(Boolean);
    html.className = Array.from(new Set(tokens)).join(" ");
  };
  normalizeClassName();
  const fallback = palettes.includes(sanitize(configFallback)) ? sanitize(configFallback) : "palette-teal";
  let stored = "";
  try {
    stored = sanitize(localStorage.getItem("pref-palette") || "");
  } catch (e) {
    /* ignore */
  }
  const next = palettes.includes(stored) ? stored : fallback;
  if (!next) return;
  for (const p of palettes) html.classList.remove(p);
  html.classList.add(next);
})();
</script>
