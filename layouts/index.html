{{ define "main" }}
  {{ partial "home_hero.html" . }}
  {{/* After hero/list, show the regular paginated posts list */}}
  {{ $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}
  {{ $pages = where $pages "Params.hiddenInHomeList" "!=" "true"  }}
  {{ $paginator := .Paginate $pages }}
  <section class="home-dossier" aria-label="Latest posts">
    <header class="dossier-head">
      <p class="eyebrow">Latest</p>
      <h2>Dossier</h2>
      <p class="lede">A text-forward archive: field notes, design notes, and the quiet glue between them.</p>
    </header>
    <div class="dossier">
      {{ range $page := $paginator.Pages }}
        {{- $pillar := "" -}}
        {{- if strings.Contains $page.RelPermalink "/posts/engineering/" -}}
          {{- $pillar = "engineering" -}}
        {{- else if strings.Contains $page.RelPermalink "/posts/adventures/" -}}
          {{- $pillar = "adventures" -}}
        {{- end -}}
        <article class="dossier-entry">
          <div class="dossier-meta">
            <time class="dossier-date" datetime="{{ $page.Date.Format "2006-01-02" }}">{{ $page.Date.Format "2006.01.02" }}</time>
            {{- if $pillar -}}
              <span class="dossier-pill pillar-{{ $pillar }}">{{ strings.Title $pillar }}</span>
            {{- end -}}
            {{- with $page.File -}}
              <span class="dossier-id">ID {{ .ContentBaseName | upper }}</span>
            {{- end -}}
            <span class="dossier-rt">{{ $page.ReadingTime }}m</span>
          </div>
          <div class="dossier-main">
            <h3 class="dossier-title">
              <a href="{{ $page.RelPermalink }}">{{ $page.Title }}</a>
              {{- if $page.Draft -}}<span class="dossier-draft" title="Draft">draft</span>{{- end -}}
            </h3>
            {{- if ne ($page.Param "hideSummary") true -}}
            <p class="dossier-summary">{{ $page.Summary | plainify | htmlUnescape }}{{ if $page.Truncated }}...{{ end }}</p>
            {{- end -}}
          </div>
        </article>
      {{ end }}
    </div>
  </section>
  {{ if gt $paginator.TotalPages 1 }}
  <footer class="page-footer">
    <nav class="pagination">
      {{ if $paginator.HasPrev }}
      <a class="prev" href="{{ $paginator.Prev.URL | absURL }}">« Prev</a>
      {{ end }}
      {{ if $paginator.HasNext }}
      <a class="next" href="{{ $paginator.Next.URL | absURL }}">Next »</a>
      {{ end }}
    </nav>
  </footer>
  {{ end }}
{{ end }}
